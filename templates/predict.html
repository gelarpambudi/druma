<!doctype html>
<html>
    <head>
        <title>DRUMA</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
    <header>
        <div>
            <h1>DRUMA</h1>
            <p>Eksperimen Druma</p>
        </div>
    </header>
    
    <body>
        <h2 class="text">Select file(s) to upload</h2>

        <p>
	        {% with messages = get_flashed_messages() %}
	            {% if messages %}
	            <script>
		            var messages = {{ messages | safe }};
		            for (var i=0; i<messages.length; i++) {
		                alert(messages[i]);
		            }
	            </script>
	            {% endif %}
	        {% endwith %}
        </p>

        <form method="post" action="" enctype="multipart/form-data">
            <dl>
                <p>
                    <input type="file" name="files" class="button3" autocomplete="off" required>
                    <input type="text" name="patch_size" placeholder="Patch Size" class="input_form" required>
                    <input type="text" name="spatial_resolution" placeholder="Spatial Resolution" class="input_form" required>
                </p>
            </dl>
            <p>
                <input type="submit" value="Upload" class="button4">
            </p>
        </form>

        {% if filename %}
        <p> Merah: {{ box_count[0] }}</p>
        <p> Kuning: {{ box_count[1] }}</p>
        <p> Hijau: {{ box_count[2] }}</p>
            {% if '.tif' in filename %}
            <div>
                <script type="text/javascript" src="https://cdn.rawgit.com/seikichi/tiff.js/f03d7965/tiff.min.js"></script>
                <script>
                    var xhr = new XMLHttpRequest();
                    xhr.responseType = 'arraybuffer';
                    xhr.open('GET', "{{ url_for('static', filename=img_path) }}");
                    xhr.onload = function (e) {
                                        Tiff.initialize({
                                            TOTAL_MEMORY: 500000000
                                        });
                                        var tiff = new Tiff({buffer: xhr.response});
                                        var canvas = tiff.toCanvas();
                                        document.body.appendChild(canvas);
                                    };
                    xhr.send(null);
                </script>
                <style>
                    canvas {
                            min-height: 60px;
                            }
                </style>
            </div>
            {% else -%}
            <div>
                <img src="{{ url_for('static', filename=img_path) }}">
            </div>
            {% endif%}
        {% endif %}
    </body>
</html>